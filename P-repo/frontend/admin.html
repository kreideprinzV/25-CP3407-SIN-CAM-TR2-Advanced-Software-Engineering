<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Management System - Admin</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .admin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .admin-section {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #ecf0f1;
        }

        .section-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin: 0;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .admin-table th,
        .admin-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.9rem;
        }

        .admin-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .admin-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .action-buttons {
            display: flex;
            gap: 0.25rem;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }

        .form-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #ecf0f1;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }

        .close-btn:hover {
            color: #2c3e50;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-grid-full {
            grid-column: 1 / -1;
        }

        .availability-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background: #ccc;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #27ae60;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(25px);
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .overview-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .overview-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.25rem;
        }

        .overview-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-overview {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">RMS Dashboard</a>
            <ul class="nav-links">
                <li><a href="index.html">Dashboard</a></li>
                <li><a href="tables.html">Tables</a></li>
                <li><a href="menu.html">Menu</a></li>
                <li><a href="orders.html">Orders</a></li>
                <li><a href="inventory.html">Inventory</a></li>
                <li><a href="admin.html" class="active">Admin</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Admin Panel</h1>
            <p class="page-subtitle">Manage menu items, categories, and system settings</p>
        </div>

        <!-- Overview Statistics -->
        <div class="stats-overview">
            <div class="overview-card">
                <div class="overview-number" id="totalMenuItems">0</div>
                <div class="overview-label">Menu Items</div>
            </div>
            <div class="overview-card">
                <div class="overview-number" id="totalCategories">0</div>
                <div class="overview-label">Categories</div>
            </div>
            <div class="overview-card">
                <div class="overview-number" id="totalCustomizations">0</div>
                <div class="overview-label">Customizations</div>
            </div>
            <div class="overview-card">
                <div class="overview-number" id="totalInventoryItems">0</div>
                <div class="overview-label">Inventory Items</div>
            </div>
        </div>

        <!-- Admin Sections -->
        <div class="admin-grid">
            <!-- Menu Items Management -->
            <div class="admin-section">
                <div class="section-header">
                    <h3 class="section-title">Menu Items</h3>
                    <button class="btn btn-primary btn-sm" onclick="adminManager.showMenuItemForm()">
                        Add New Item
                    </button>
                </div>
                <div id="menuItemsList">
                    <div class="loading">Loading menu items...</div>
                </div>
            </div>

            <!-- Categories Management -->
            <div class="admin-section">
                <div class="section-header">
                    <h3 class="section-title">Categories</h3>
                    <button class="btn btn-primary btn-sm" onclick="adminManager.showCategoryForm()">
                        Add Category
                    </button>
                </div>
                <div id="categoriesList">
                    <div class="loading">Loading categories...</div>
                </div>
            </div>

            <!-- Customizations Management -->
            <div class="admin-section">
                <div class="section-header">
                    <h3 class="section-title">Customizations</h3>
                    <button class="btn btn-primary btn-sm" onclick="adminManager.showCustomizationForm()">
                        Add Customization
                    </button>
                </div>
                <div id="customizationsList">
                    <div class="loading">Loading customizations...</div>
                </div>
            </div>

            <!-- Inventory Items Management -->
            <div class="admin-section">
                <div class="section-header">
                    <h3 class="section-title">Inventory Items</h3>
                    <button class="btn btn-primary btn-sm" onclick="adminManager.showInventoryItemForm()">
                        Add Inventory Item
                    </button>
                </div>
                <div id="inventoryItemsList">
                    <div class="loading">Loading inventory items...</div>
                </div>
            </div>
        </div>

        <!-- Form Modal -->
        <div id="formModal" class="form-modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Form</h3>
                    <button type="button" class="close-btn" onclick="adminManager.closeModal()">&times;</button>
                </div>
                <div id="modalForm">
                    <!-- Form content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        class AdminManager {
            constructor() {
                this.menuItems = [];
                this.categories = [];
                this.customizations = [];
                this.inventoryItems = [];
                this.inventoryCategories = [];
                this.currentEditId = null;
                this.currentEditType = null;
                this.init();
            }

            async init() {
                await this.loadAllData();
                this.renderAllSections();
                this.updateOverviewStats();
            }

            async loadAllData() {
                try {
                    const [menuResponse, categoriesResponse, customizationsResponse, inventoryResponse, invCategoriesResponse] = await Promise.all([
                        api.getMenuItems(),
                        api.getCategories(),
                        api.getCustomizations(),
                        api.getInventoryItems(),
                        api.getInventoryCategories()
                    ]);

                    this.menuItems = menuResponse.results || [];
                    this.categories = categoriesResponse.results || [];
                    this.customizations = customizationsResponse.results || [];
                    this.inventoryItems = inventoryResponse.results || [];
                    this.inventoryCategories = invCategoriesResponse.results || [];

                } catch (error) {
                    console.error('Error loading admin data:', error);
                    showAlert('Error loading admin data. Please check your connection.', 'error');
                }
            }

            renderAllSections() {
                this.renderMenuItems();
                this.renderCategories();
                this.renderCustomizations();
                this.renderInventoryItems();
            }

            updateOverviewStats() {
                document.getElementById('totalMenuItems').textContent = this.menuItems.length;
                document.getElementById('totalCategories').textContent = this.categories.length;
                document.getElementById('totalCustomizations').textContent = this.customizations.length;
                document.getElementById('totalInventoryItems').textContent = this.inventoryItems.length;
            }

            renderMenuItems() {
                const container = document.getElementById('menuItemsList');
                
                if (this.menuItems.length === 0) {
                    container.innerHTML = '<p class="text-center">No menu items found.</p>';
                    return;
                }

                const html = `
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Price</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${this.menuItems.map(item => {
                                const category = this.categories.find(cat => cat.id === item.category);
                                return `
                                    <tr>
                                        <td>${item.name}</td>
                                        <td>${formatCurrency(item.price)}</td>
                                        <td>${category ? category.name : 'Unknown'}</td>
                                        <td>
                                            <span class="badge ${item.is_available ? 'badge-success' : 'badge-danger'}">
                                                ${item.is_available ? 'Available' : 'Unavailable'}
                                            </span>
                                        </td>
                                        <td>
                                            <div class="action-buttons">
                                                <button class="btn btn-warning btn-sm" onclick="adminManager.editMenuItem(${item.id})">Edit</button>
                                                <button class="btn btn-danger btn-sm" onclick="adminManager.deleteMenuItem(${item.id})">Delete</button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;

                container.innerHTML = html;
            }

            renderCategories() {
                const container = document.getElementById('categoriesList');
                
                if (this.categories.length === 0) {
                    container.innerHTML = '<p class="text-center">No categories found.</p>';
                    return;
                }

                const html = `
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${this.categories.map(category => `
                                <tr>
                                    <td>${category.name}</td>
                                    <td>${category.description || 'No description'}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn btn-warning btn-sm" onclick="adminManager.editCategory(${category.id})">Edit</button>
                                            <button class="btn btn-danger btn-sm" onclick="adminManager.deleteCategory(${category.id})">Delete</button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                container.innerHTML = html;
            }

            renderCustomizations() {
                const container = document.getElementById('customizationsList');
                
                if (this.customizations.length === 0) {
                    container.innerHTML = '<p class="text-center">No customizations found.</p>';
                    return;
                }

                const html = `
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Price</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${this.customizations.map(custom => {
                                const category = this.categories.find(cat => cat.id === custom.category);
                                return `
                                    <tr>
                                        <td>${custom.name}</td>
                                        <td>${formatCurrency(custom.price)}</td>
                                        <td>${category ? category.name : 'Unknown'}</td>
                                        <td>
                                            <span class="badge ${custom.is_available ? 'badge-success' : 'badge-danger'}">
                                                ${custom.is_available ? 'Available' : 'Unavailable'}
                                            </span>
                                        </td>
                                        <td>
                                            <div class="action-buttons">
                                                <button class="btn btn-warning btn-sm" onclick="adminManager.editCustomization(${custom.id})">Edit</button>
                                                <button class="btn btn-danger btn-sm" onclick="adminManager.deleteCustomization(${custom.id})">Delete</button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;

                container.innerHTML = html;
            }

            renderInventoryItems() {
                const container = document.getElementById('inventoryItemsList');
                
                if (this.inventoryItems.length === 0) {
                    container.innerHTML = '<p class="text-center">No inventory items found.</p>';
                    return;
                }

                const html = `
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Quantity</th>
                                <th>Unit</th>
                                <th>Category</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${this.inventoryItems.slice(0, 10).map(item => {
                                const category = this.inventoryCategories.find(cat => cat.id === item.category);
                                return `
                                    <tr>
                                        <td>${item.name}</td>
                                        <td>${item.quantity}</td>
                                        <td>${item.unit}</td>
                                        <td>${category ? category.name : 'Unknown'}</td>
                                        <td>
                                            <div class="action-buttons">
                                                <button class="btn btn-warning btn-sm" onclick="adminManager.editInventoryItem(${item.id})">Edit</button>
                                                <button class="btn btn-danger btn-sm" onclick="adminManager.deleteInventoryItem(${item.id})">Delete</button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                    ${this.inventoryItems.length > 10 ? '<p class="text-center mt-2"><small>Showing first 10 items</small></p>' : ''}
                `;

                container.innerHTML = html;
            }

            // Form Methods
            showMenuItemForm(item = null) {
                this.currentEditType = 'menuItem';
                this.currentEditId = item ? item.id : null;

                const modalTitle = document.getElementById('modalTitle');
                const modalForm = document.getElementById('modalForm');

                modalTitle.textContent = item ? 'Edit Menu Item' : 'Add New Menu Item';

                modalForm.innerHTML = `
                    <form id="menuItemForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Name:</label>
                                <input type="text" id="itemName" class="form-control" value="${item ? item.name : ''}" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Price:</label>
                                <input type="number" id="itemPrice" class="form-control" step="0.01" min="0" value="${item ? item.price : ''}" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category:</label>
                                <select id="itemCategory" class="form-control" required>
                                    <option value="">Select Category</option>
                                    ${this.categories.map(cat => 
                                        `<option value="${cat.id}" ${item && item.category === cat.id ? 'selected' : ''}>${cat.name}</option>`
                                    ).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Available:</label>
                                <div class="availability-toggle">
                                    <div class="toggle-switch ${item ? (item.is_available ? 'active' : '') : 'active'}" onclick="this.classList.toggle('active')">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span>Available for ordering</span>
                                </div>
                            </div>
                            <div class="form-group form-grid-full">
                                <label class="form-label">Description:</label>
                                <textarea id="itemDescription" class="form-control" rows="3">${item ? (item.description || '') : ''}</textarea>
                            </div>
                        </div>
                        <div class="form-group mt-3">
                            <button type="submit" class="btn btn-success">${item ? 'Update' : 'Create'} Menu Item</button>
                            <button type="button" class="btn btn-secondary" onclick="adminManager.closeModal()">Cancel</button>
                        </div>
                    </form>
                `;

                document.getElementById('formModal').classList.remove('hidden');

                // Add form submit handler
                document.getElementById('menuItemForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveMenuItem();
                });
            }

            showCategoryForm(category = null) {
                this.currentEditType = 'category';
                this.currentEditId = category ? category.id : null;

                const modalTitle = document.getElementById('modalTitle');
                const modalForm = document.getElementById('modalForm');

                modalTitle.textContent = category ? 'Edit Category' : 'Add New Category';

                modalForm.innerHTML = `
                    <form id="categoryForm">
                        <div class="form-group">
                            <label class="form-label">Name:</label>
                            <input type="text" id="categoryName" class="form-control" value="${category ? category.name : ''}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description:</label>
                            <textarea id="categoryDescription" class="form-control" rows="3">${category ? (category.description || '') : ''}</textarea>
                        </div>
                        <div class="form-group mt-3">
                            <button type="submit" class="btn btn-success">${category ? 'Update' : 'Create'} Category</button>
                            <button type="button" class="btn btn-secondary" onclick="adminManager.closeModal()">Cancel</button>
                        </div>
                    </form>
                `;

                document.getElementById('formModal').classList.remove('hidden');

                document.getElementById('categoryForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveCategory();
                });
            }

            showCustomizationForm(customization = null) {
                this.currentEditType = 'customization';
                this.currentEditId = customization ? customization.id : null;

                const modalTitle = document.getElementById('modalTitle');
                const modalForm = document.getElementById('modalForm');

                modalTitle.textContent = customization ? 'Edit Customization' : 'Add New Customization';

                modalForm.innerHTML = `
                    <form id="customizationForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Name:</label>
                                <input type="text" id="customName" class="form-control" value="${customization ? customization.name : ''}" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Price:</label>
                                <input type="number" id="customPrice" class="form-control" step="0.01" min="0" value="${customization ? customization.price : ''}" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category:</label>
                                <select id="customCategory" class="form-control" required>
                                    <option value="">Select Category</option>
                                    ${this.categories.map(cat => 
                                        `<option value="${cat.id}" ${customization && customization.category === cat.id ? 'selected' : ''}>${cat.name}</option>`
                                    ).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Available:</label>
                                <div class="availability-toggle">
                                    <div class="toggle-switch ${customization ? (customization.is_available ? 'active' : '') : 'active'}" onclick="this.classList.toggle('active')">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span>Available</span>
                                </div>
                            </div>
                            <div class="form-group form-grid-full">
                                <label class="form-label">Description:</label>
                                <textarea id="customDescription" class="form-control" rows="3">${customization ? (customization.description || '') : ''}</textarea>
                            </div>
                        </div>
                        <div class="form-group mt-3">
                            <button type="submit" class="btn btn-success">${customization ? 'Update' : 'Create'} Customization</button>
                            <button type="button" class="btn btn-secondary" onclick="adminManager.closeModal()">Cancel</button>
                        </div>
                    </form>
                `;

                document.getElementById('formModal').classList.remove('hidden');

                document.getElementById('customizationForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveCustomization();
                });
            }

            showInventoryItemForm(item = null) {
                this.currentEditType = 'inventoryItem';
                this.currentEditId = item ? item.id : null;

                const modalTitle = document.getElementById('modalTitle');
                const modalForm = document.getElementById('modalForm');

                modalTitle.textContent = item ? 'Edit Inventory Item' : 'Add New Inventory Item';

                modalForm.innerHTML = `
                    <form id="inventoryItemForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Name:</label>
                                <input type="text" id="invItemName" class="form-control" value="${item ? item.name : ''}" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Unit:</label>
                                <input type="text" id="invItemUnit" class="form-control" value="${item ? item.unit : ''}" placeholder="kg, pcs, liters, etc." required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Quantity:</label>
                                <input type="number" id="invItemQuantity" class="form-control" step="0.01" min="0" value="${item ? item.quantity : ''}" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Threshold:</label>
                                <input type="number" id="invItemThreshold" class="form-control" step="0.01" min="0" value="${item ? item.threshold : ''}" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category:</label>
                                <select id="invItemCategory" class="form-control" required>
                                    <option value="">Select Category</option>
                                    ${this.inventoryCategories.map(cat => 
                                        `<option value="${cat.id}" ${item && item.category === cat.id ? 'selected' : ''}>${cat.name}</option>`
                                    ).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Supplier:</label>
                                <input type="text" id="invItemSupplier" class="form-control" value="${item ? (item.supplier || '') : ''}" placeholder="Optional">
                            </div>
                        </div>
                        <div class="form-group mt-3">
                            <button type="submit" class="btn btn-success">${item ? 'Update' : 'Create'} Inventory Item</button>
                            <button type="button" class="btn btn-secondary" onclick="adminManager.closeModal()">Cancel</button>
                        </div>
                    </form>
                `;

                document.getElementById('formModal').classList.remove('hidden');

                document.getElementById('inventoryItemForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveInventoryItem();
                });
            }

            // Save Methods
            async saveMenuItem() {
                const formData = {
                    name: document.getElementById('itemName').value,
                    price: parseFloat(document.getElementById('itemPrice').value),
                    category: parseInt(document.getElementById('itemCategory').value),
                    description: document.getElementById('itemDescription').value,
                    is_available: document.querySelector('.toggle-switch').classList.contains('active')
                };

                try {
                    if (this.currentEditId) {
                        await api.updateMenuItem(this.currentEditId, formData);
                        showAlert('Menu item updated successfully!', 'success');
                    } else {
                        await api.createMenuItem(formData);
                        showAlert('Menu item created successfully!', 'success');
                    }

                    await this.loadAllData();
                    this.renderAllSections();
                    this.updateOverviewStats();
                    this.closeModal();

                } catch (error) {
                    console.error('Error saving menu item:', error);
                    showAlert('Error saving menu item. Please try again.', 'error');
                }
            }

            async saveCategory() {
                const formData = {
                    name: document.getElementById('categoryName').value,
                    description: document.getElementById('categoryDescription').value
                };

                try {
                    if (this.currentEditId) {
                        await api.put(`/menu/categories/${this.currentEditId}/`, formData);
                        showAlert('Category updated successfully!', 'success');
                    } else {
                        await api.post('/menu/categories/', formData);
                        showAlert('Category created successfully!', 'success');
                    }

                    await this.loadAllData();
                    this.renderAllSections();
                    this.updateOverviewStats();
                    this.closeModal();

                } catch (error) {
                    console.error('Error saving category:', error);
                    showAlert('Error saving category. Please try again.', 'error');
                }
            }

            async saveCustomization() {
                const formData = {
                    name: document.getElementById('customName').value,
                    price: parseFloat(document.getElementById('customPrice').value),
                    category: parseInt(document.getElementById('customCategory').value),
                    description: document.getElementById('customDescription').value,
                    is_available: document.querySelector('.toggle-switch').classList.contains('active')
                };

                try {
                    if (this.currentEditId) {
                        await api.put(`/menu/customizations/${this.currentEditId}/`, formData);
                        showAlert('Customization updated successfully!', 'success');
                    } else {
                        await api.post('/menu/customizations/', formData);
                        showAlert('Customization created successfully!', 'success');
                    }

                    await this.loadAllData();
                    this.renderAllSections();
                    this.updateOverviewStats();
                    this.closeModal();

                } catch (error) {
                    console.error('Error saving customization:', error);
                    showAlert('Error saving customization. Please try again.', 'error');
                }
            }

            async saveInventoryItem() {
                const formData = {
                    name: document.getElementById('invItemName').value,
                    unit: document.getElementById('invItemUnit').value,
                    quantity: parseFloat(document.getElementById('invItemQuantity').value),
                    threshold: parseFloat(document.getElementById('invItemThreshold').value),
                    category: parseInt(document.getElementById('invItemCategory').value),
                    supplier: document.getElementById('invItemSupplier').value || null
                };

                try {
                    if (this.currentEditId) {
                        await api.updateInventoryItem(this.currentEditId, formData);
                        showAlert('Inventory item updated successfully!', 'success');
                    } else {
                        await api.createInventoryItem(formData);
                        showAlert('Inventory item created successfully!', 'success');
                    }

                    await this.loadAllData();
                    this.renderAllSections();
                    this.updateOverviewStats();
                    this.closeModal();

                } catch (error) {
                    console.error('Error saving inventory item:', error);
                    showAlert('Error saving inventory item. Please try again.', 'error');
                }
            }

            // Edit Methods
            editMenuItem(id) {
                const item = this.menuItems.find(i => i.id === id);
                if (item) this.showMenuItemForm(item);
            }

            editCategory(id) {
                const category = this.categories.find(c => c.id === id);
                if (category) this.showCategoryForm(category);
            }

            editCustomization(id) {
                const customization = this.customizations.find(c => c.id === id);
                if (customization) this.showCustomizationForm(customization);
            }

            editInventoryItem(id) {
                const item = this.inventoryItems.find(i => i.id === id);
                if (item) this.showInventoryItemForm(item);
            }

            // Delete Methods
            async deleteMenuItem(id) {
                if (!confirm('Are you sure you want to delete this menu item?')) return;

                try {
                    await api.deleteMenuItem(id);
                    showAlert('Menu item deleted successfully!', 'success');
                    
                    await this.loadAllData();
                    this.renderAllSections();
                    this.updateOverviewStats();

                } catch (error) {
                    console.error('Error deleting menu item:', error);
                    showAlert('Error deleting menu item. Please try again.', 'error');
                }
            }

            async deleteCategory(id) {
                if (!confirm('Are you sure you want to delete this category?')) return;

                try {
                    await api.delete(`/menu/categories/${id}/`);
                    showAlert('Category deleted successfully!', 'success');
                    
                    await this.loadAllData();
                    this.renderAllSections();
                    this.updateOverviewStats();

                } catch (error) {
                    console.error('Error deleting category:', error);
                    showAlert('Error deleting category. Please try again.', 'error');
                }
            }

            async deleteCustomization(id) {
                if (!confirm('Are you sure you want to delete this customization?')) return;

                try {
                    await api.delete(`/menu/customizations/${id}/`);
                    showAlert('Customization deleted successfully!', 'success');
                    
                    await this.loadAllData();
                    this.renderAllSections();
                    this.updateOverviewStats();

                } catch (error) {
                    console.error('Error deleting customization:', error);
                    showAlert('Error deleting customization. Please try again.', 'error');
                }
            }

            async deleteInventoryItem(id) {
                if (!confirm('Are you sure you want to delete this inventory item?')) return;

                try {
                    await api.deleteInventoryItem(id);
                    showAlert('Inventory item deleted successfully!', 'success');
                    
                    await this.loadAllData();
                    this.renderAllSections();
                    this.updateOverviewStats();

                } catch (error) {
                    console.error('Error deleting inventory item:', error);
                    showAlert('Error deleting inventory item. Please try again.', 'error');
                }
            }

            closeModal() {
                document.getElementById('formModal').classList.add('hidden');
                this.currentEditId = null;
                this.currentEditType = null;
            }
        }

        // Initialize admin manager when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.adminManager = new AdminManager();
        });
    </script>
</body>
</html>
